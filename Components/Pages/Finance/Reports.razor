@page "/finance/reports"
@using Microsoft.AspNetCore.Authorization
@using CentuitionApp.Data
@using CentuitionApp.Components.Pages.Finance.ReportsComponents
@using CentuitionApp.Components.Pages.Finance.DashboardComponents
@attribute [Authorize]
@rendermode InteractiveServer

<PageTitle>Reports - Centuition</PageTitle>

<div class="container-fluid py-4">
    <!-- Header -->
    <ReportsHeader StartDate="@reportStartDate"
                   OnStartDateChanged="@((DateTime? value) => reportStartDate = value)"
                   EndDate="@reportEndDate"
                   OnEndDateChanged="@((DateTime? value) => reportEndDate = value)"
                   OnGenerateReport="@LoadReportData" />

    <!-- Quick Date Filters -->
    <QuickDateFilters OnDateRangeSelected="@SetDateRange" />

    @if (isLoading)
    {
        <div class="d-flex justify-content-center py-5">
            <TelerikLoader Visible="true" Size="@ThemeConstants.Loader.Size.Large" />
        </div>
    }
    else
    {
        <!-- Summary Cards -->
        <div class="row mb-4 g-3">
            <div class="col-md-3">
                <SummaryCard Title="Total Income"
                             Value="@totalIncome"
                             BorderColor="success"
                             Subtitle="@($"{incomeTransactions.Count} transactions")"
                             FullHeight="true" />
            </div>
            <div class="col-md-3">
                <SummaryCard Title="Total Expenses"
                             Value="@totalExpenses"
                             BorderColor="danger"
                             Subtitle="@($"{expenseTransactions.Count} transactions")"
                             FullHeight="true" />
            </div>
            <div class="col-md-3">
                <SummaryCard Title="Net Savings"
                             Value="@netSavings"
                             BorderColor="info"
                             DynamicValueColor="true"
                             Subtitle="@($"{savingsRate:0}% savings rate")"
                             FullHeight="true" />
            </div>
            <div class="col-md-3">
                <SummaryCard Title="Avg. Daily Expense"
                             Value="@avgDailyExpense"
                             BorderColor="warning"
                             Subtitle="@($"Over {dayCount} days")"
                             FullHeight="true" />
            </div>
        </div>

        <!-- Charts Row 1 -->
        <div class="row mb-4 g-3">
            <!-- Income vs Expenses Trend -->
            <div class="col-lg-8">
                <IncomeVsExpensesTrendChart TrendData="@trendData" />
            </div>

            <!-- Spending by Category -->
            <div class="col-lg-4">
                <CategorySpendingChart Data="@categorySpending" Height="400px" />
            </div>
        </div>

        <!-- Charts Row 2 -->
        <div class="row mb-4 g-3">
            <!-- Net Savings Trend -->
            <div class="col-lg-6">
                <NetSavingsTrendChart TrendData="@trendData" />
            </div>

            <!-- Account Balances -->
            <div class="col-lg-6">
                <AccountBalancesChart Accounts="@accounts" />
            </div>
        </div>

        <!-- Category Breakdown Table -->
        <div class="row mb-4">
            <div class="col-12">
                <CategoryBreakdownTable CategorySpending="@categorySpending" />
            </div>
        </div>

        <!-- Transaction Details -->
        <div class="row">
            <div class="col-12">
                <TransactionDetailsGrid Transactions="@allTransactions" />
            </div>
        </div>
    }
</div>
